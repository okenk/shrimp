---
title: "Shrimp modeling"
output: html_notebook
---

## Data:
Data we have at month-year-fishing area resolution:

* Average length and sample size for each age class (1-3) from April to October, i.e., up to 21 observations of each year class in a given area, but some combinations are missing.
* SD for each age class from 2014-2018 (actually have individual data for each shrimp measured in these years)
* Total catch in lbs
* Count per pound
* Percent age composition of the catch by number
* All of this for 1989-2018, though a lot of pubs seems to have 1980-present

## Length model:
$L_{a,y,m}$ is length of age $a$ shrimp in month $m$ of year $y$. Then

$$\begin{aligned}
L_{1,y,1} &= \alpha_0 + \epsilon_{1,y,1} \\
L_{a,y,m} &= \alpha_1 + L_{a,y,m-1} + \epsilon_{a,y,m} \\
L_{a,y,1} &= \alpha_2 + L_{a-1, y-1, m_{\max}} + \epsilon_{a,y,1}
\end{aligned}$$

$\alpha_0$ is average size at recruitment to the fishery, $\alpha_1$ is the monthly within fishing season growth increment, and $\alpha_2$ is the across fishing season growth increment. Right now I assume $\alpha_1 = \alpha_2$, though I don't think that is correct as there is not much wintertime growth. I tried to also estimate $\beta_1$ and $\beta_2$ that get multiplied by length (i.e., mean reverting AR process instead of random walk), but $\alpha$ and $\beta$ were so tightly correlated it seemed pointless. (Could add it back in since it won't impact mixing-- Stan is great! Or is there a way to reparameterize?) All of these can be functions of environmental variables. There is also an existing theory that growth is density-dependent, so they grow less when there are more shrimp around. The process variability $\epsilon$ follows a normal distribution, and I estimate a separate $\sigma_\text{init size}$ and $\sigma_\text{growth}$.

## Observation model:

$$\bar{L}_{a,y,m,area} \sim N\left(L_{a,y,m}, \frac{\sigma_\text{obs}}{\sqrt{n_{a,y,m,area}}} \right) $$

where $\bar{L}_{a,y,m,area}$ is the empirical mean length for age $a$ in month $m$ of year $y$ sampled in area $area$, $\sigma_\text{obs}$ is the observation standard deviation, and $n_{a,y,m,area}$ is the number of age $a$ shrimp that were sampled from the catch in month $m$ of year $y$ in area $area$. 

## Fitting:

The model is fit in stan as a multivariate autoregressive state-space model. Each year class is a different "state," but the underlying parameters for each state are the same (for now). Each area represents a different observation process of the same state. There is some visual evidence that a few areas have consistently small shrimp-- I could potentially make some of the parameters hierarchical to incorporate this?

Martell et al. 2000 report annual M of 0.96 $\text{yr}^{-1}$, which is used in VPA. 

